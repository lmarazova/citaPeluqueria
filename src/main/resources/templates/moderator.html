<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Peluquería</title>
  <link rel="icon" type="image/x-icon" th:href="@{../img/favicon.ico}">
  <link rel="stylesheet" th:href="@{/css/styles.css}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

</head>
<body class="register-page"><!--class="page-title display-4 text-center"-->
<header th:replace="fragments/header :: header"></header>
<div class="container mt-3" sec:authorize="hasRole('ADMIN')">
  <button type="button" class="btn btn-outline-light" onclick="history.back()">
    ← Volver
  </button>
</div>
<main class="container mt-4"></main>
<div class="container mt-4">
  <h1 class="page-title display-4 text-center" th:text="'Bienvenido al Panel de PELUQUERO ' + ${hairdresser.username}"></h1>

  <div class="row mt-5">
      <!-- Formulario (mitad izquierda) -->
      <div class="col-md-6">
        <div th:replace="fragments/register-client-form :: register-client-form"></div>
      </div>

      <!-- Horarios disponibles (mitad derecha) -->
        <div class="col-md-6">
          <div class="slot-section">
            <h2>Tus horarios</h2>
            <div class="row" id="accordionGrid">
              <div th:each="entry, iterStat : ${groupedSlots}" class="col-12 col-md-6 col-lg-4 mb-3">
                <!-- Encabezado estilo tarjeta -->
                <div class="card h-100">
                  <div class="card-header text-center hairdresser-schedule" style="cursor:pointer"
                       data-bs-toggle="collapse"
                       th:attr="data-bs-target='#collapse' + ${iterStat.index}"
                       aria-expanded="false"
                       th:attrappend=" aria-controls='collapse' + ${iterStat.index}">
                    <strong th:text="${#temporals.format(entry.key, 'dd MMMM yyyy')}"></strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Acordeones desplegables FUERA de la grilla, pero siguen funcionando -->
            <div th:each="entry, iterStat : ${groupedSlots}">
              <div th:attr="id='collapse' + ${iterStat.index}"
                   class="accordion-collapse collapse mt-2 position-relative">

                <!-- Botón de cierre (con acceso directo al ID generado) -->
                <button type="button"
                        class="btn btn-sm btn-danger position-absolute"
                        style="top: 10px; right: 10px; z-index: 9999;"
                        th:attr="onclick='bootstrap.Collapse.getInstance(document.getElementById(\'collapse' + ${iterStat.index} + '\')).hide()'">
                  ✕
                </button>

                <div class="accordion-body border rounded bg-transparent p-3">
                  <h5 class="text-center mb-3" style="color: white;" th:text="${#temporals.format(entry.key, 'EEEE dd MMMM yyyy')}"></h5>

                  <div class="d-flex flex-wrap gap-2 justify-content-start">
                    <div th:each="slot : ${entry.value}"
                         th:class="'badge badge-selectable badge-fixed-size ' + (${slot.client} != null ? 'bg-danger text-white' : 'bg-success text-white')"
                         style="min-width: 120px;">
                      <div>
                        <span th:text="${#temporals.format(slot.startHour, 'HH:mm')} + ' - ' + ${#temporals.format(slot.finalHour, 'HH:mm')}"></span><br/>

                        <small th:if="${slot.client != null}"
                               th:text="'Ocupado: ' + ${slot.client.username}"
                               th:attr="onclick='openClientModal(' + '\'' + ${slot.client.id} + '\'' + ')'"
                               style="cursor:pointer; text-decoration: underline;">
                        </small>


                        <small th:unless="${slot.client != null}">
                          Disponible
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      <!-- ===================== BUSCAR CLIENTE ===================== -->
            <h2>Buscar cliente</h2>

            <label for="client-select"></label>
            <select id="client-select"
                    class="form-select mb-3 custom-select-transparent"
                    onchange="loadClientDetails(this.value)">
              <option value="">-- Selecciona un cliente --</option>
            </select>
            <div th:replace="fragments/modal-reusable :: modal-reusable"></div>
       </div>
      </div>

  <footer th:replace="fragments/footer :: footer"></footer>

  <script th:src="@{/js/hairdresser-panel.js}"></script>
  <script th:src="@{/js/custom-panel.js}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>




</body>

</html>